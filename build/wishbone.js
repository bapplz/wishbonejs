(function(){this.App=function(){function a(a){this.eventReceiver=new EventReceiver,this.routes=new Routes,this.presenterManager=new PresenterManager(instanceBuilder),this.eventDispatcher=new EventDispatcher(this.eventReceiver,this.routes,this.presenterManager),this.routes.add("root",a)}return a.prototype.start=function(){var a;return this.eventDispatcher.start(),a=this.presenterManager.create(this.routes.getHandler("root").name),a.on("eventHandled",this.eventDispatcher.onEventHandled.bind(this.eventDispatcher)),a.present()},a}()}).call(this),function(){this.BaseView=function(){function a(){}return a.prototype.setPresenter=function(a){return this.presenter=a},a}()}.call(this),function(){this.EventDispatcher=function(){function a(a,b,c){this.eventReceiver=a,this.routes=b,this.presenterManager=c,this.readyToDispatch=!0}return a.prototype.start=function(){return this.eventReceiver.on("afterEventReceived",this.onDispatchEvent.bind(this))},a.prototype.onDispatchEvent=function(a){if(this.readyToDispatch===!0)return this.fireNextEvent()},a.prototype.fireNextEvent=function(){var a,b,c;a=this.eventReceiver.poll();if(a===null)return;return this.readyToDispatch=!1,c=this.routes.getHandler(a.type).name,b=this.presenterManager.create(c),b.on("eventHandled",this.onEventHandled.bind(this)),b.present()},a.prototype.onEventHandled=function(a){return this.readyToDispatch=!0,this.fireNextEvent()},a}()}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};this.EventReceiver=function(a){function c(){this.events=[],c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.createCallbackSlots=function(){return this.addCallbackSlots("beforeEventReceived"),this.addCallbackSlots("afterEventReceived"),this.addCallbackSlots("beforeEventRemoved")},c.prototype.receive=function(a){var b;return b=new Object,b.type=a.type,this.trigger("beforeEventReceived",b),this.events.push(a),this.trigger("afterEventReceived",b)},c.prototype.poll=function(){var a,b;return b=this.events[0],b===void 0?b=null:(a=new Object,a.type=b.type,this.trigger("beforeEventRemoved",a)),this.events.splice(0,1),b},c}(Publisher)}.call(this),function(){this.InstanceBuilder=function(){function a(){}return a.prototype.build=function(a){var b;return b=a,new window[b]},a}()}.call(this),function(){this.NameExtractor=function(){function a(){}return a.extract=function(a){var b;return a===""?a:(b=a.search(/\S[A-Z]\S/)+1,a.slice(0,b))},a}()}.call(this),function(){this.PresenterManager=function(){function a(a){this.instanceBuilder=a}return a.prototype.create=function(a){var b,c,d,e;return b=NameExtractor.extract(a),e=b+"View",c=this.instanceBuilder.build(a),d=this.instanceBuilder.build(e),c.setView(d),d.setPresenter(c)},a}()}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};a=function(){function a(){this.callbacks=[],this.createCallbackSlots()}return a.prototype.createCallbackSlots=function(){},a.prototype.on=function(a,b){return this.addCallbackSlots(a),this.callbacks[a].push(b)},a.prototype.trigger=function(a,b){var c,d,e,f,g;d=this.callbacks[a],g=[];for(e=0,f=d.length;e<f;e++)c=d[e],g.push(c(b));return g},a.prototype.addCallbackSlots=function(a){return this.callbacks[a]=[]},a}(),this.EventReceiver=function(a){function b(){this.events=[],b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.createCallbackSlots=function(){return this.addCallbackSlots("beforeEventReceived"),this.addCallbackSlots("afterEventReceived"),this.addCallbackSlots("beforeEventRemoved")},b.prototype.receive=function(a){var b;return b=new Object,b.type=a.type,this.trigger("beforeEventReceived",b),this.events.push(a),this.trigger("afterEventReceived",b)},b.prototype.poll=function(){var a,b;return b=this.events[0],b===void 0?b=null:(a=new Object,a.type=b.type,this.trigger("beforeEventRemoved",a)),this.events.splice(0,1),b},b}(a),this.BasePresenter=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.setView=function(a){return this.view=a},b.prototype.createCallbackSlots=function(){return this.addCallbackSlots("eventHandled")},b.prototype.done=function(){var a;return a=new Object,a.type="eventHandled",this.trigger("eventHandled",a)},b}(a)}.call(this),function(){this.Routes=function(){function a(){this.routes=[]}return a.prototype.add=function(a,b){return this.routes[a]=b},a.prototype.getHandler=function(a){return this.routes[a]},a}()}.call(this);