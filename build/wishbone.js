(function(){this.App=function(){function a(a){var b;this.eventReceiver=new EventReceiver,this.routes=new Routes,b=new InstanceBuilder,this.presenterManager=new PresenterManager(b),this.eventDispatcher=new EventDispatcher(this.eventReceiver,this.routes,this.presenterManager),this.routes.add("root",a)}return a.prototype.addRoute=function(a,b){return this.routes.add(a,b)},a.prototype.start=function(){var a,b;return this.eventDispatcher.start(),a=this.presenterManager.create(this.routes.getHandler("root").name),a.on("eventHandled",this.eventDispatcher.onEventHandled.bind(this.eventDispatcher)),b=this.presenterManager.createView(a),b.show()},a}()}).call(this),function(){this.BaseView=function(){function a(){}return a.prototype.setPresenter=function(a){return this.presenter=a,this.bindPresenterEvents()},a.prototype.bindPresenterEvents=function(){},a.prototype.show=function(){},a}()}.call(this),function(){this.EventDispatcher=function(){function a(a,b,c){this.eventReceiver=a,this.routes=b,this.presenterManager=c,this.readyToDispatch=!0}return a.prototype.start=function(){return this.eventReceiver.on("afterEventReceived",this.onDispatchEvent.bind(this))},a.prototype.onDispatchEvent=function(a){if(this.readyToDispatch===!0)return this.fireNextEvent()},a.prototype.fireNextEvent=function(){var a,b,c,d,e;a=this.eventReceiver.poll();if(a===null)return;b=this.routes.getHandler(a.type);if(b===null){this.fireNextEvent();return}return d=b.name,this.readyToDispatch=!1,c=this.presenterManager.create(d),c.on("eventHandled",this.onEventHandled.bind(this)),c.presentWith(a),e=this.presenterManager.createView(c),e.show()},a.prototype.onEventHandled=function(a){return this.readyToDispatch=!0,this.fireNextEvent()},a}()}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};this.EventReceiver=function(a){function c(){this.events=[],c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.createCallbackSlots=function(){return this.addCallbackSlots("beforeEventReceived"),this.addCallbackSlots("afterEventReceived"),this.addCallbackSlots("beforeEventRemoved")},c.prototype.receive=function(a){var b;return b=new Object,b.type=a.type,this.trigger("beforeEventReceived",b),this.events.push(a),this.trigger("afterEventReceived",b)},c.prototype.poll=function(){var a,b;return b=this.events[0],b===void 0?b=null:(a=new Object,a.type=b.type,this.trigger("beforeEventRemoved",a)),this.events.splice(0,1),b},c}(Publisher)}.call(this),function(){this.InstanceBuilder=function(){function a(){}return a.prototype.build=function(a){return new window[a]},a}()}.call(this),function(){this.NameExtractor=function(){function a(){}return a.extract=function(a){var b,c;return a===""?a:(c=a.match(/.*([A-Z])/g),c.length===0?"":(b=c[0],b.substring(0,b.length-1)))},a}()}.call(this),function(){this.PresenterManager=function(){function a(a){this.instanceBuilder=a}return a.prototype.create=function(a){return this.instanceBuilder.build(a)},a.prototype.createView=function(a){var b,c,d;return b=NameExtractor.extract(a.constructor.name),d=b+"View",c=this.instanceBuilder.build(d),c.setPresenter(a),c},a}()}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};this.Publisher=function(){function a(){this.callbacks=[],this.createCallbackSlots()}return a.prototype.createCallbackSlots=function(){},a.prototype.on=function(a,b){return this.addCallbackSlots(a),this.callbacks[a].push(b)},a.prototype.trigger=function(a,b){var c,d,e,f,g;d=this.callbacks[a],g=[];for(e=0,f=d.length;e<f;e++)c=d[e],g.push(c(b));return g},a.prototype.addCallbackSlots=function(a){return this.callbacks[a]=[]},a}(),this.EventReceiver=function(a){function c(){this.events=[],c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.createCallbackSlots=function(){return this.addCallbackSlots("beforeEventReceived"),this.addCallbackSlots("afterEventReceived"),this.addCallbackSlots("beforeEventRemoved")},c.prototype.receive=function(a){var b;return b=new Object,b.type=a.type,this.trigger("beforeEventReceived",b),this.events.push(a),this.trigger("afterEventReceived",b)},c.prototype.poll=function(){var a,b;return b=this.events[0],b===void 0?b=null:(a=new Object,a.type=b.type,this.trigger("beforeEventRemoved",a)),this.events.splice(0,1),b},c}(Publisher),this.BasePresenter=function(a){function c(){c.__super__.constructor.apply(this,arguments),this.addCallbackSlots("eventHandled")}return b(c,a),c.prototype.presentWith=function(a){},c.prototype.done=function(){var a;return a=new Object,a.type="eventHandled",this.trigger("eventHandled",a)},c}(Publisher)}.call(this),function(){this.Routes=function(){function a(){this.routes=[]}return a.prototype.add=function(a,b){return this.routes[a]=b},a.prototype.getHandler=function(a){return this.routes[a]===void 0?null:this.routes[a]},a}()}.call(this);